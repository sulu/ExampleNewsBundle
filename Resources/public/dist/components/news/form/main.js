define(["underscore","jquery","text!./form.html"],function(a,b,c){return{defaults:{templates:{form:c,url:"/admin/api/news<% if (!!id) { %>/<%= id %><% } %>"},translations:{title:"public.title",content:"news.content",media:"news.media"}},header:{title:"news.headline",toolbar:{buttons:{save:{parent:"saveWithOptions"}}}},layout:{content:{width:"fixed",leftSpace:!0,rightSpace:!0}},initialize:function(){this.render(),this.bindDomEvents(),this.bindCustomEvents()},render:function(){this.$el.html(this.templates.form({translations:this.translations,locale:this.sandbox.sulu.user.locale})),this.form=this.sandbox.form.create("#news-form"),this.form.initialized.then(function(){this.sandbox.form.setData("#news-form",this.data||{}).then(function(){this.sandbox.start(this.$el)}.bind(this))}.bind(this))},bindDomEvents:function(){this.$el.find("input, textarea").on("keypress",function(){this.sandbox.emit("sulu.header.toolbar.item.enable","save")}.bind(this))},bindCustomEvents:function(){this.sandbox.on("sulu.toolbar.save",this.save.bind(this)),this.sandbox.on("sulu.header.back",function(){this.sandbox.emit("sulu.router.navigate","example/news")}.bind(this)),this.sandbox.on("sulu.content.changed",function(){this.sandbox.emit("sulu.header.toolbar.item.enable","save")}.bind(this))},save:function(a){if(this.sandbox.form.validate("#news-form")){var b=this.sandbox.form.getData("#news-form"),c=this.templates.url({id:this.options.id});this.sandbox.util.save(c,this.options.id?"PUT":"POST",b).then(function(b){this.afterSave(b,a)}.bind(this))}},afterSave:function(a,b){this.sandbox.emit("sulu.header.toolbar.item.disable","save"),"back"===b?this.sandbox.emit("sulu.router.navigate","example/news"):"new"===b?this.sandbox.emit("sulu.router.navigate","example/news/add"):this.options.id||this.sandbox.emit("sulu.router.navigate","example/news/edit:"+a.id)},loadComponentData:function(){var c=b.Deferred();return this.options.id?(this.sandbox.util.load(a.template(this.defaults.templates.url,{id:this.options.id})).done(function(a){c.resolve(a)}),c):(c.resolve(),c)}}});